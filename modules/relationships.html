<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Relacje - Simplify CRM</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- FONTS & STYLES -->
        <link rel="stylesheet" href="../styles/base.css">
        <link rel="stylesheet" href="../styles/relationships.css">

</head>
<body>
    <!-- HEADER -->
    <header class="app-header">
        <div class="app-header-inner">
            <div class="app-header-left">
                <div class="app-logo">Simplify CRM</div>
                <div class="app-logo-subtitle">Modu≈Ç: Relacje</div>
            </div>
            <div class="app-header-right">
                <span class="user-email" id="userEmail"></span>
                <button id="logoutBtn" class="logout-btn">Wyloguj</button>
            </div>
        </div>
    </header>

    <!-- BREADCRUMB -->
    <div class="breadcrumb">
        <a href="../index.html" class="back-to-dashboard">
            <span>‚Üê</span>
            <span>Powr√≥t do Dashboard</span>
        </a>
    </div>

    <!-- APP -->
    <div class="app-container">
        <!-- GLOBAL SEARCH -->
        <div class="global-search">
            <div class="search-input-container">
                <span class="search-icon">üîç</span>
                <input id="globalSearchInput" type="text" placeholder="Szukaj w firmach i kontaktach..." autocomplete="off">
                <button id="clearSearchBtn" type="button" class="clear-search-btn">Wyczy≈õƒá</button>
            </div>
            <p class="search-hint">
                Szukaj po nazwie firmy, osobie, stanowisku, e-mailu, telefonie, bran≈ºy, mie≈õcie itd.
            </p>
        </div>

        <!-- TABS -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="contacts">Kontakty</button>
            <button class="tab-btn" data-tab="companies">Firmy</button>
        </div>

        <!-- TAB: CONTACTS -->
        <div id="contactsTab" class="tab-content active">
            <!-- LIST VIEW -->
            <div id="contactsListView">
                <div class="section-header">
                    <div class="section-title-block">
                        <h1 class="section-title">Kontakty</h1>
                        <div class="section-underline"></div>
                        <p class="section-subtitle">
                            ZarzƒÖdzaj wszystkimi osobami kontaktowymi. Kontakty mogƒÖ byƒá przypisane do firm lub istnieƒá niezale≈ºnie.
                        </p>
                    </div>
                    <div class="toolbar">
                        <!-- Tags Manager Icon -->
                        <button type="button" class="tags-manager-icon" onclick="openTagsManager('contacts')" title="ZarzƒÖdzaj etykietami">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                <line x1="7" y1="7" x2="7.01" y2="7"></line>
                            </svg>
                        </button>
                        
                        <!-- Tag Filter Button -->
                        <div class="tag-filter-wrapper" id="contactsTagFilterWrapper">
                            <button class="tag-filter-btn" id="contactsTagFilterBtn" onclick="toggleTagFilterDropdown('contacts')" title="Filtruj po etykiecie">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                                </svg>
                            </button>
                            <div class="tag-filter-dropdown" id="contactsTagFilterDropdown"></div>
                        </div>
                        
                        <!-- Active Filter Chip (hidden by default) -->
                        <div class="active-tag-filter" id="contactsActiveFilter" style="display: none;">
                            <span class="filter-color"></span>
                            <span class="filter-name"></span>
                            <button class="filter-clear" onclick="clearTagFilter()">&times;</button>
                        </div>

                        <div class="view-switcher">
                            <button class="view-btn active" data-view="grid" title="Widok kafelk√≥w" onclick="switchContactsView('grid')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="7" height="7" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="3" width="7" height="7" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="14" width="7" height="7" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="3" y="14" width="7" height="7" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="view-btn" data-view="list" title="Widok listy" onclick="switchContactsView('list')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="8" y1="6" x2="21" y2="6" stroke-linecap="round"/>
                                    <line x1="8" y1="12" x2="21" y2="12" stroke-linecap="round"/>
                                    <line x1="8" y1="18" x2="21" y2="18" stroke-linecap="round"/>
                                    <line x1="3" y1="6" x2="3.01" y2="6" stroke-linecap="round"/>
                                    <line x1="3" y1="12" x2="3.01" y2="12" stroke-linecap="round"/>
                                    <line x1="3" y1="18" x2="3.01" y2="18" stroke-linecap="round"/>
                                </svg>
                            </button>
                        </div>
                        <button id="addContactBtn" class="add-btn">
                            <span class="plus">+</span>
                            <span>Dodaj kontakt</span>
                        </button>
                    </div>
                </div>

                <div id="contactsLoading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>≈Åadowanie kontakt√≥w...</p>
                </div>

                <div id="contactsEmpty" class="empty-state" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                    </svg>
                    <h3>Brak kontakt√≥w</h3>
                    <p>Dodaj pierwszy kontakt, aby rozpoczƒÖƒá pracƒô w CRM.</p>
                </div>

                <div id="contactsGrid" class="cards-grid"></div>
                <div id="contactsList" class="list-view" style="display: none;"></div>
            </div>

            <!-- CONTACT DETAIL VIEW -->
            <div id="contactDetailView" class="detail-view">
                <button id="backToContactsBtn" class="back-btn">
                    <span>‚Üê</span>
                    <span>Powr√≥t do listy kontakt√≥w</span>
                </button>

                <div class="detail-layout">
                    <!-- LEFT: INFO CARD + COMPANY OF CONTACT -->
                    <div class="detail-column-left">
                        <div class="detail-card">
                            <div id="contactDetailContent"></div>
                        </div>
                        <div class="section-header small">
                            <div class="section-title-block">
                                <h1 class="section-title">Firma kontaktu</h1>
                                <div class="section-underline"></div>
                            </div>
                        </div>

                        <div id="contactCompanyEmpty" class="empty-state small" style="display: none;">
                            <h3>Brak firmy</h3>
                            <p>Ten kontakt nie jest jeszcze przypisany do firmy.</p>
                        </div>

                        <div id="contactCompanyCardContainer" class="detail-list"></div>
                    </div>

                    <!-- RIGHT: CONTACT HISTORY -->
    <div class="detail-column-right">
        <div class="history-header">
            <div class="history-header-top">
                <h2 class="history-title">Historia kontaktu</h2>
                <div class="history-action-buttons">
                    <button id="addContactActivityBtn" class="add-btn history-add-btn">
                        <span class="plus">+</span>
                        <span>Dodaj aktywno≈õƒá</span>
                    </button>
                    <button id="addContactNoteBtn" class="add-btn history-add-btn">
                        <span class="plus">+</span>
                        <span>Dodaj notatkƒô</span>
                    </button>
                </div>
            </div>
            <div class="history-controls">
                <div class="history-tabs">
                    <button class="history-tab-btn active" data-entity="contact" data-scope="all">Wszystko</button>
                    <button class="history-tab-btn" data-entity="contact" data-scope="notes">Notatki</button>
                    <button class="history-tab-btn" data-entity="contact" data-scope="activities">Aktywno≈õci</button>
                    <button class="history-tab-btn" data-entity="contact" data-scope="full">Full stream</button>
                </div>
            </div>
        </div>

                        <div id="contactHistoryEmpty" class="empty-state small" style="display:none;">
                            <h3>Brak historii</h3>
                            <p>Nie dodano jeszcze ≈ºadnych notatek ani zdarze≈Ñ dla tego kontaktu.</p>
                        </div>
                        <div id="contactHistoryList" class="history-list"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB: COMPANIES -->
        <div id="companiesTab" class="tab-content">
            <!-- COMPANY LIST VIEW -->
            <div id="companiesListView">
                <div class="section-header">
                    <div class="section-title-block">
                        <h1 class="section-title">Firmy</h1>
                        <div class="section-underline"></div>
                        <p class="section-subtitle">
                            ZarzƒÖdzaj listƒÖ firm, z kt√≥rymi wsp√≥≈Çpracujesz. Ka≈ºda firma mo≈ºe mieƒá przypisanych wielu kontakt√≥w oraz historiƒô wsp√≥≈Çpracy.
                        </p>
                    </div>
                    <div class="toolbar">
                        <!-- Tags Manager Icon -->
                        <button type="button" class="tags-manager-icon" onclick="openTagsManager('companies')" title="ZarzƒÖdzaj etykietami">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                                <line x1="7" y1="7" x2="7.01" y2="7"></line>
                            </svg>
                        </button>
                        
                        <!-- Tag Filter Button -->
                        <div class="tag-filter-wrapper" id="companiesTagFilterWrapper">
                            <button class="tag-filter-btn" id="companiesTagFilterBtn" onclick="toggleTagFilterDropdown('companies')" title="Filtruj po etykiecie">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
                                </svg>
                            </button>
                            <div class="tag-filter-dropdown" id="companiesTagFilterDropdown"></div>
                        </div>
                        
                        <!-- Active Filter Chip (hidden by default) -->
                        <div class="active-tag-filter" id="companiesActiveFilter" style="display: none;">
                            <span class="filter-color"></span>
                            <span class="filter-name"></span>
                            <button class="filter-clear" onclick="clearTagFilter()">&times;</button>
                        </div>

                        <div class="view-switcher">
                            <button class="view-btn active" data-view="grid" title="Widok kafelk√≥w" onclick="switchCompaniesView('grid')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="7" height="7" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="3" width="7" height="7" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="14" y="14" width="7" height="7" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="3" y="14" width="7" height="7" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </button>
                            <button class="view-btn" data-view="list" title="Widok listy" onclick="switchCompaniesView('list')">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="8" y1="6" x2="21" y2="6" stroke-linecap="round"/>
                                    <line x1="8" y1="12" x2="21" y2="12" stroke-linecap="round"/>
                                    <line x1="8" y1="18" x2="21" y2="18" stroke-linecap="round"/>
                                    <line x1="3" y1="6" x2="3.01" y2="6" stroke-linecap="round"/>
                                    <line x1="3" y1="12" x2="3.01" y2="12" stroke-linecap="round"/>
                                    <line x1="3" y1="18" x2="3.01" y2="18" stroke-linecap="round"/>
                                </svg>
                            </button>
                        </div>
                        <button id="addCompanyBtn" class="add-btn">
                            <span class="plus">+</span>
                            <span>Dodaj firmƒô</span>
                        </button>
                    </div>
                </div>

                <div id="companiesLoading" class="loading" style="display: none;">
                    <div class="spinner"></div>
                    <p>≈Åadowanie firm...</p>
                </div>

                <div id="companiesEmpty" class="empty-state" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                    <h3>Brak firm</h3>
                    <p>Dodaj pierwszƒÖ firmƒô, aby rozpoczƒÖƒá pracƒô w CRM.</p>
                </div>

                <div id="companiesGrid" class="cards-grid"></div>
                <div id="companiesList" class="list-view" style="display: none;"></div>
            </div>

            <!-- COMPANY DETAIL VIEW -->
            <div id="companyDetailView" class="detail-view">
                <button id="backToCompaniesBtn" class="back-btn">
                    <span>‚Üê</span>
                    <span>Powr√≥t do listy firm</span>
                </button>

                <div class="detail-layout">
                    <!-- LEFT: INFO CARD + CONTACTS IN COMPANY -->
                    <div class="detail-column-left">
                        <div class="detail-card">
                            <div id="companyDetailContent"></div>
                        </div>
                        <div class="section-header small">
                            <div class="section-title-block">
                                <h1 class="section-title">Kontakty w firmie</h1>
                                <div class="section-underline"></div>
                            </div>
                            <div class="toolbar">
                                <button id="addCompanyContactBtn" class="add-btn">
                                    <span class="plus">+</span>
                                    <span>Dodaj kontakt</span>
                                </button>
                            </div>
                        </div>

                        <div id="companyContactsEmpty" class="empty-state small" style="display: none;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                            </svg>
                            <h3>Brak kontakt√≥w</h3>
                            <p>Dodaj pierwszy kontakt dla tej firmy.</p>
                        </div>

                        <div id="companyContactsList" class="detail-list"></div>
                    </div>

                    <!-- RIGHT: COMPANY HISTORY -->
    <div class="detail-column-right">
        <div class="history-header">
            <div class="history-header-top">
                <h2 class="history-title">Historia firmy</h2>
                <div class="history-action-buttons">
                    <button id="addCompanyActivityBtn" class="add-btn history-add-btn">
                        <span class="plus">+</span>
                        <span>Dodaj aktywno≈õƒá</span>
                    </button>
                    <button id="addCompanyNoteBtn" class="add-btn history-add-btn">
                        <span class="plus">+</span>
                        <span>Dodaj notatkƒô</span>
                    </button>
                </div>
            </div>
            <div class="history-controls">
                <div class="history-tabs">
                    <button class="history-tab-btn active" data-entity="company" data-scope="all">Wszystko</button>
                    <button class="history-tab-btn" data-entity="company" data-scope="notes">Notatki</button>
                    <button class="history-tab-btn" data-entity="company" data-scope="activities">Aktywno≈õci</button>
                    <button class="history-tab-btn" data-entity="company" data-scope="full">Full stream</button>
                </div>
            </div>
        </div>
                        <div id="companyHistoryEmpty" class="empty-state small" style="display:none;">
                            <h3>Brak historii</h3>
                            <p>Nie dodano jeszcze ≈ºadnych notatek ani zdarze≈Ñ dla tej firmy.</p>
                        </div>
                        <div id="companyHistoryList" class="history-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL: ADD/EDIT COMPANY -->
    <div id="companyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="companyModalTitle">Dodaj firmƒô</h2>
                <button class="close-btn" id="closeCompanyModalBtn">&times;</button>
            </div>
<form id="companyForm">
                <div class="form-group">
                    <label for="companyName">Nazwa firmy *</label>
                    <input type="text" id="companyName" required>
                </div>
                <div class="form-group">
                    <label for="companyDomain">Domena <span class="optional">(opcjonalnie)</span></label>
                    <input type="text" id="companyDomain" placeholder="np. techcorp.pl">
                    <small style="display: block; margin-top: 0.4rem; font-size: 0.75rem; color: var(--text-secondary); line-height: 1.5;">
                        üí° Strona WWW zostanie utworzona automatycznie na podstawie domeny.
                    </small>
                </div>
                <div class="form-group">
                    <label for="companyIndustry">Bran≈ºa <span class="optional">(opcjonalnie)</span></label>
                    <input type="text" id="companyIndustry" placeholder="np. IT, Marketing, Finanse">
                </div>
                <div class="form-group">
                    <label for="companyPhone">Telefon firmowy <span class="optional">(opcjonalnie)</span></label>
                    <input type="tel" id="companyPhone" placeholder="np. +48 123 456 789">
                </div>
                <div class="form-group">
                    <label for="companyCity">Miasto <span class="optional">(opcjonalnie)</span></label>
                    <input type="text" id="companyCity" placeholder="np. Warszawa">
                </div>
                <div class="form-group">
                    <label for="companyCountry">Kraj <span class="optional">(opcjonalnie)</span></label>
                    <input type="text" id="companyCountry" placeholder="np. Polska">
                </div>
                <div class="form-group">
                    <label>Etykiety</label>
                    <div id="companyTagsSelector" class="tags-selector-container">
                        <span style="font-size:0.8rem; color:var(--text-secondary);">Najpierw utw√≥rz etykiety w ustawieniach (ikona üè∑Ô∏è)</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="companyNotes">Notatki <span class="optional">(opcjonalnie)</span></label>
                    <textarea id="companyNotes" placeholder="Dodatkowe informacje o firmie"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelCompanyBtn">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Zapisz</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: ADD/EDIT CONTACT -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="contactModalTitle">Dodaj kontakt</h2>
                <button class="close-btn" id="closeContactModalBtn">&times;</button>
            </div>
            <form id="contactForm">
                <div class="form-group">
                    <label for="contactName">Imiƒô i nazwisko *</label>
                    <input type="text" id="contactName" required>
                </div>
                <div class="form-group">
                    <label for="contactEmail">Email <span class="optional">(opcjonalnie)</span></label>
                    <input type="email" id="contactEmail" placeholder="np. jan@techcorp.pl">
                </div>
                <div class="form-group">
                    <label for="contactCompanyInput">Firma <span class="optional">(opcjonalnie)</span></label>
                    <div class="company-picker">
                        <input type="text" id="contactCompanyInput" placeholder="Zacznij pisaƒá nazwƒô firmy...">
                        <input type="hidden" id="contactCompanyId">
                        <div id="companySuggestions" class="company-suggestions"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="contactPosition">Stanowisko <span class="optional">(opcjonalnie)</span></label>
                    <input type="text" id="contactPosition" placeholder="np. CEO, Marketing Manager">
                </div>
                <div class="form-group">
                    <label for="contactPhone">Telefon <span class="optional">(opcjonalnie)</span></label>
                    <input type="tel" id="contactPhone">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelContactBtn">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Zapisz</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: ADD NOTE -->
    <div id="noteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="noteModalTitle">Dodaj notatkƒô</h2>
                <button class="close-btn" id="closeNoteModalBtn">&times;</button>
            </div>
            <form id="noteForm">
                <input type="hidden" id="noteEntityType">
                <input type="hidden" id="noteEntityId">
                <div class="form-group">
                    <label for="noteContent">Tre≈õƒá notatki *</label>
                    <textarea id="noteContent" required placeholder="Wpisz notatkƒô dotyczƒÖcƒÖ tej firmy / kontaktu..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelNoteBtn">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Zapisz notatkƒô</button>
                </div>
            </form>
        </div>
    </div>

    <!-- MODAL: DUPLICATE WARNING -->
    <div id="duplicateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ö†Ô∏è Mo≈ºliwy duplikat</h2>
                <button class="close-btn" onclick="closeDuplicateModal()">&times;</button>
            </div>
            <div id="duplicateContent" style="margin: 1.5rem 0; line-height: 1.7;"></div>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="backToEditBtn">Wr√≥ƒá do edycji</button>
                <button type="button" class="btn btn-primary" id="saveAnywayBtn">Zapisz mimo to</button>
            </div>
        </div>
    </div>

    <!-- Google APIs -->
    <script src="https://apis.google.com/js/api.js" async defer></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <!-- CRM LOGIC -->
        <script type="module" src="./relationships.js"></script>


    <!-- Tags Manager Modal -->
    <div id="tagsManagerModal" class="modal tags-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ZarzƒÖdzanie etykietami</h2>
                <button class="close-btn" onclick="closeTagsManager()">√ó</button>
            </div>

            <!-- Tabs -->
            <div class="tags-modal-tabs">
                <button class="tags-modal-tab active" data-type="companies" onclick="switchTagsTab('companies')">
                    Etykiety firm
                </button>
                <button class="tags-modal-tab" data-type="contacts" onclick="switchTagsTab('contacts')">
                    Etykiety os√≥b
                </button>
            </div>

            <!-- Companies Tags Section -->
            <div id="companiesTagsSection" class="tags-section active">
                <div class="tag-form-section">
                    <form id="companyTagForm" onsubmit="return saveCompanyTag(event)">
                        <div class="form-group">
                            <label>Nazwa etykiety</label>
                            <input type="text" id="companyTagName" placeholder="np. VIP Klient" required>
                            <input type="hidden" id="companyTagId">
                            <input type="hidden" id="companyTagRowIndex">
                        </div>
                        <div class="form-group">
                            <label>Kolor</label>
                            <div class="color-picker-grid" id="companyTagColorPicker"></div>
                            <input type="hidden" id="companyTagColor" value="#3b82f6">
                        </div>
                        <div class="form-group">
                            <label>Opis <span class="optional">(opcjonalnie)</span></label>
                            <textarea id="companyTagDescription" placeholder="Opis etykiety..." rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <span id="companyTagSubmitText">Dodaj etykietƒô</span>
                        </button>
                    </form>
                </div>
                <div class="tags-list-section">
                    <h3>IstniejƒÖce etykiety</h3>
                    <div id="companyTagsList" class="tags-list"></div>
                </div>
            </div>

            <!-- Contacts Tags Section -->
            <div id="contactsTagsSection" class="tags-section" style="display: none;">
                <div class="tag-form-section">
                    <form id="contactTagForm" onsubmit="return saveContactTag(event)">
                        <div class="form-group">
                            <label>Nazwa etykiety</label>
                            <input type="text" id="contactTagName" placeholder="np. Decydent" required>
                            <input type="hidden" id="contactTagId">
                            <input type="hidden" id="contactTagRowIndex">
                        </div>
                        <div class="form-group">
                            <label>Kolor</label>
                            <div class="color-picker-grid" id="contactTagColorPicker"></div>
                            <input type="hidden" id="contactTagColor" value="#3b82f6">
                        </div>
                        <div class="form-group">
                            <label>Opis <span class="optional">(opcjonalnie)</span></label>
                            <textarea id="contactTagDescription" placeholder="Opis etykiety..." rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" style="width: 100%;">
                            <span id="contactTagSubmitText">Dodaj etykietƒô</span>
                        </button>
                    </form>
                </div>
                <div class="tags-list-section">
                    <h3>IstniejƒÖce etykiety</h3>
                    <div id="contactTagsList" class="tags-list"></div>
                </div>
            </div>
        </div>
    </div>
<!-- MODAL: ADD ACTIVITY -->
    <div id="activityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="activityModalTitle">Dodaj aktywno≈õƒá</h2>
                <button class="close-btn" id="closeActivityModalBtn">&times;</button>
            </div>
            <form id="activityForm">
                <input type="hidden" id="activityEntityType">
                <input type="hidden" id="activityEntityId">
                <input type="hidden" id="activityType" value="EMAIL">
                
                <!-- Type selector -->
                <div class="form-group">
                    <label>Typ aktywno≈õci *</label>
                    <div class="activity-type-selector" id="activityTypeSelector">
                        <button type="button" class="activity-type-btn active" data-type="EMAIL">
                            <span class="type-icon">üìß</span>
                            <span class="type-label">Email</span>
                        </button>
                        <button type="button" class="activity-type-btn" data-type="PHONE">
                            <span class="type-icon">üìû</span>
                            <span class="type-label">Telefon</span>
                        </button>
                        <button type="button" class="activity-type-btn" data-type="MEETING">
                            <span class="type-icon">ü§ù</span>
                            <span class="type-label">Spotkanie</span>
                        </button>
                        <button type="button" class="activity-type-btn" data-type="TASK">
                            <span class="type-icon">‚úÖ</span>
                            <span class="type-label">Zadanie</span>
                        </button>
                    </div>
                </div>
                
                <!-- Title -->
                <div class="form-group">
                    <label for="activityTitle">Tytu≈Ç *</label>
                    <input type="text" id="activityTitle" required placeholder="np. Rozmowa ws. oferty">
                </div>
                
                <!-- Date -->
                <div class="form-group">
                    <label for="activityDate">Data i czas *</label>
                    <input type="datetime-local" id="activityDate" required>
                </div>
                
                <!-- Notes -->
                <div class="form-group">
                    <label for="activityNotes">Notatki <span class="optional">(opcjonalnie)</span></label>
                    <textarea id="activityNotes" placeholder="Szczeg√≥≈Çowe informacje..."></textarea>
                </div>
                
                <!-- Contact selector (when from company) -->
                <div class="form-group" id="activityContactSelectorGroup" style="display: none;">
                    <label for="activityContactSelect">Przypisz do osoby <span class="optional">(opcjonalnie)</span></label>
                    <select id="activityContactSelect">
                        <option value="">Tylko firma</option>
                    </select>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelActivityBtn">Anuluj</button>
                    <button type="submit" class="btn btn-primary">Zapisz aktywno≈õƒá</button>
                </div>
            </form>
        </div>
    </div>
</body>
</html>
